# Installs packages to run edx locally on a single instance
#
---
- name: 'Check required variables'
  assert:
    that: "{{ item }} is defined"
    msg: "define '{{ item }}' before executing this role"
  with_items:
    - TENANT_NAME

- name: Install python-mysqldb
  apt:
    name: python-mysqldb
    state: latest

- name: create databases
  mysql_db:
    login_host: "{{ STATEFUL_MYSQL_LOGIN_HOST }}"
    login_password: "{{ STATEFUL_MYSQL_LOGIN_PASSWORD }}"
    login_user: "{{ STATEFUL_MYSQL_LOGIN_USER }}"
    db: "{{ item }}"
    state: present
    encoding: utf8
  when: item != None and item != ''
  with_items: "{{ mysql_setup_databases }}"

- name: create database users
  mysql_user:
    login_host: "{{ STATEFUL_MYSQL_LOGIN_HOST }}"
    login_password: "{{ STATEFUL_MYSQL_LOGIN_PASSWORD }}"
    login_user: "{{ STATEFUL_MYSQL_LOGIN_USER }}"
    host: "%"
    name: "{{ STATEFUL_MYSQL_USER }}"
    password: "{{ STATEFUL_MYSQL_PASS }}"
    priv: "{{ item }}.*:ALL"
    append_privs: yes
  when: item.db != None and item.db != ''
  with_items: "{{ mysql_setup_databases }}"

- name: create mongo user and database


#
#- name: create rmq vhost
#
#- name: create rmq user
#
