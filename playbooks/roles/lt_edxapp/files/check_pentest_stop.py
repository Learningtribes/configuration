import os
import boto3
from datetime import datetime

ACCESS_KEY = os.environ['AWS_ACCESS_KEY_ID']
SECRET_KEY = os.environ['AWS_SECRET_ACCESS_KEY']
PENTEST_ID = os.environ['PENTEST_ID']

client = boto3.client('ec2', region_name='eu-west-1', aws_access_key_id=ACCESS_KEY, aws_secret_access_key=SECRET_KEY)

pentest_client = client.describe_instance_status(InstanceIds=[PENTEST_ID], IncludeAllInstances=True)

check_time = datetime.today()

if 0 <= check_time.weekday() < 5:
	check_time_hour = check_time.hour
	check_time_min = check_time.minute
	check_time_sec = check_time.second
	total_seconds = check_time_hour * 3600 + check_time_min * 60 + check_time_sec
	if 2700 <= total_seconds <= 7200 or 48600 <= total_seconds <= 59400:
		pass
	else:
		client.stop_instances(InstanceIds=[PENTEST_ID])